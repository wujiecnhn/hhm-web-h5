!function(){function e(e,t,o){$.ajax({type:"POST",url:e,data:t,timeout:15e3,success:function(e,t,i){-1===e.status?($.toast(e.msg,2e3),setTimeout(function(){location.href="/logout"},2e3)):e.status?o(null,e):o(e.msg,null)},error:function(t,i,s){console.error(e+" error: "+i+"##"+s),o("服务异常",null)}})}require.config({baseUrl:"./js",paths:{Vue:"./lib/vue.min",Utils:"./lib/utils.min"},shim:{Vue:{exports:"Vue"},Utils:{exports:"Utils"}}}),require(["Vue","Utils"],function(t,o){"use strict";t.config.delimiters=["${","}"],t.config.unsafeDelimiters=["{!!","!!}"],$(document).on("pageInit","#page-index",function(o,i,s){function r(e,t){var o=c.recommends.filter(function(t){return t.SysNo===e});if(o.length>0){var i=o[0].RecommendItems[t];i.isCombination?location.href="/product/group-detail?id="+i.ProductGroupSysNo:location.href="/product/detail?id="+i.ProductGroupSysNo}}function a(){location.href="/product/search?key="+encodeURI(encodeURI(c.searchWord))}function n(t){var o=c.carousels[t];if(o)return 2===o.RecommendSubType?void(location.href="/product/secKill"):0===o.RecommendSubType?void(location.href="/product/recommend?id="+o.SysNo+"&name="+o.RecommendName):1===o.RecommendSubType?(e("/product/get-carousel",{carouselId:o.SysNo},function(e,t){$.hidePreloader(),e?$.toast(e,1e3):t.carousel.length>0&&t.carousel[0].RecommendItems.length>0&&(location.href="/product/detail?id="+t.carousel[0].RecommendItems[0].ProductGroupSysNo)}),void $.showPreloader("请稍等...")):void 0}var c=new t({el:"#page-index",data:{searchWord:"",banners:[{img:"http://img.alicdn.com/tps/i1/TB1M8ZOLVXXXXX8XpXXX3a8GpXX-700-500.jpg",url:"http://wxp.xitie10.com/product/new"},{img:"http://img.alicdn.com/tps/i1/TB11.gILVXXXXaQXpXXP3C8GpXX-700-500.png",url:"http://wxp.xitie10.com/product/secKill"},{img:"http://img.alicdn.com/tps/i1/TB1S3oNLVXXXXXSXpXXX3a8GpXX-700-500.jpg",url:"http://wxp.xitie10.com/product/group"},{img:"http://img.alicdn.com/tps/i1/TB1S3oNLVXXXXXSXpXXX3a8GpXX-700-500.jpg",url:"http://wxp.xitie10.com/product/recommend?id=14&name=0323栏目一"}],newsImg:"",salesImg:"",groupImg:"",secKillImg:"",recommends:[],carousels:[],message:0,swiper:null},methods:{search:a,goToDetail:r,carouselClick:n}});e("/get-home",{},function(e,o){if($.hidePreloader(),e)$.toast(e,1e3);else{var i=o.home;c.newsImg=i.news.img,c.salesImg=i.sales.img,c.groupImg=i.group.img,c.secKillImg=i.secKill.img,c.recommends=i.recommend.slice(),c.carousels=i.carousel.slice(),t.nextTick(function(){c.swiper=new Swiper(".swiper-container",{pagination:".swiper-pagination",paginationClickable:!0,spaceBetween:10,centeredSlides:!0,autoplay:2500,autoplayDisableOnInteraction:!1})})}}),$.showPreloader("请稍等..."),e("/users/get-notice-count",{},function(e,t){e||(c.message=t.count)}),$(s).on("click",".icon-clear",function(){c.searchWord=""})}),$(document).on("pageInit","#page-login",function(i,s,r){function a(t){return n.phone?n.password?o.checkMobile(n.phone)?void(n.isDisable||(e("/",{username:n.phone,password:n.password},function(e,t){$.hidePreloader(),e?$.toast(e,1e3):location.href=t.redirect}),$.showPreloader("登录中"))):void $.toast("请输入正确的手机号",1e3):void $.toast("请输入密码",1e3):void $.toast("请输入手机号",1e3)}var n=new t({el:"#page-login",data:{phone:"",password:""},computed:{isDisable:function(){return 0===this.phone.length||0===this.password.length}},methods:{login:a}});$(window).resize(function(){$(".content").scrollTop($(window).height())})}),$(document).on("pageInit","#page-register",function(i,s,r){function a(t){return c.isSendCaptcha?void 0:c.phone?o.checkMobile(c.phone)?void e("/is-registered",{phone:c.phone},function(t,o){t?$.toast(t,1e3):o.isRegistered?$.toast("该手机号已注册",1e3):(e("/get-captcha",{phone:c.phone,type:1},function(e,t){if($.hidePreloader(),e)$.toast(e,1e3);else{var o=60;c.captchaTip=o+"秒",c.isSendCaptcha=!0,c.captchaMsg="如果您未收到短信，请在60秒后再次获取";var i=setInterval(function(){o--,o>9?c.captchaTip=o+"秒":c.captchaTip="0"+o+"秒",0===o&&(c.captchaTip="获取验证码",c.isSendCaptcha=!1,c.captchaMsg="",clearInterval(i))},1e3)}}),$.showPreloader("发送中"))}):void $.toast("请输入正确的手机号",1e3):void $.toast("手机号不能为空",1e3)}function n(t){if(!c.isDisable){if(!c.phone)return void $.toast("手机号不能为空",1e3);if(!c.captcha)return void $.toast("验证码不能为空",1e3);if(c.password.length<6)return void $.toast("密码长度不能小于6位",1e3);if(!c.password)return void $.toast("密码不能为空",1e3);if(c.password!=c.rePassword)return void $.toast("密码输入不一致",1e3);if(!o.checkMobile(c.phone))return void $.toast("请输入正确的手机号",1e3);e("/register",{phone:c.phone,password:c.password,captcha:c.captcha,inviteCode:c.inviteCode},function(t,o){if($.hidePreloader(),t)$.toast(t,1e3);else{var i=o.redirect;e("/",{username:c.phone,password:c.password},function(e,t){$.hidePreloader(),e?$.toast(e,1e3):location.href=i})}}),$.showPreloader("注册中")}}var c=new t({el:"#page-register",data:{captchaTip:"获取验证码",isSendCaptcha:!1,captchaMsg:"",captcha:"",password:"",rePassword:"",phone:"",inviteCode:""},computed:{isDisable:function(){return!(this.phone&&this.captcha&&this.password&&this.rePassword)}},methods:{sendCaptcha:a,submitReg:n}})}),$(document).on("pageInit","#page-register-complete",function(i,s,r){function a(){$("#street-picker").picker({toolbarTemplate:'<header class="bar bar-nav"><button class="button button-link pull-right close-picker">              确定</button><h1 class="title">选择街道</h1></header>',onClose:c,cols:[{textAlign:"center",values:l.streetPicker}]})}function n(){var e=l.pcdDes.split(" "),t=o.getPCD(e[0],e[1],e[2]);l.pcdCode.splice(0,l.pcdCode.length),l.pcdName.splice(0,l.pcdName.length),l.pcdCode.push(t.province.id),l.pcdCode.push(t.city.id),l.pcdCode.push(t.district.id),l.pcdName.push(e[0]),l.pcdName.push(e[1]),l.pcdName.push(e[2]),p(t.district.id,function(){l.street=l.streetPicker[0],a()})}function c(){for(var e=0;e<l.streetList.length;e++){var t=l.streetList[e];if(t.Name===l.street)return void(l.streetId=t.SysNo)}}function p(t,o){e("/address/get-street",{districtId:t},function(e,t){if($.hidePreloader(),e)$.toast(e,1e3),o(e);else{l.streetList=t.street.slice(),l.streetPicker.splice(0,l.streetPicker.length);for(var i=0;i<l.streetList.length;i++)l.streetPicker.push(l.streetList[i].Name);o(null)}}),$.showPreloader("请稍等")}function d(t){return l.phone&&!o.checkMobile(l.phone)?void $.toast("请输入正确的手机号",1e3):(e("/register-complete",{phone:l.phone,storeName:l.storeName,receiver:l.receiver,pcdCode:l.pcdCode,pcdName:l.pcdName,street:l.street,streetId:l.streetId,address:l.address},function(e,t){if($.hidePreloader(),e)$.toast(e,1e3);else{$.toast("恭喜您, 注册成功！",1e3);var o=t.redirect;setTimeout(function(){location.href=o},1e3)}}),void $.showPreloader("请稍等"))}var l=new t({el:"#page-register-complete",data:{phone:"",storeName:"",receiver:"",pcdDes:"浙江省 嘉兴市 南湖区",pcdName:["浙江省","嘉兴市","南湖区"],pcdCode:[13,93,1e3],address:"",street:"建设街道",streetId:12111,streetList:[],streetPicker:[]},methods:{submitInfo:d}});$("#city-picker").cityPicker({toolbarTemplate:'<header class="bar bar-nav"><button class="button button-link pull-right close-picker">确定</button>        <h1 class="title">选择收货地址</h1></header>',onClose:n}),p(1e3,function(){a()})}),$(document).on("pageInit","#page-rest-password",function(i,s,r){function a(t){return c.isSendCaptcha?void 0:c.phone?o.checkMobile(c.phone)?void e("/is-registered",{phone:c.phone},function(t,o){t?$.toast(t,1e3):o.isRegistered?(e("/get-captcha",{phone:c.phone,type:1},function(e,t){if($.hidePreloader(),e)$.toast(e,1e3);else{var o=60;c.captchaTip=o+"秒",c.isSendCaptcha=!0,c.isDisable=!1,c.captchaMsg="如果您未收到短信，请在60秒后再次获取";var i=setInterval(function(){o--,o>9?c.captchaTip=o+"秒":c.captchaTip="0"+o+"秒",0===o&&(c.captchaTip="获取验证码",c.isSendCaptcha=!1,c.captchaMsg="",clearInterval(i))},1e3)}}),$.showPreloader("发送中")):$.toast("该手机号未注册",1e3)}):void $.toast("请输入正确的手机号",1e3):void $.toast("手机号不能为空",1e3)}function n(t){if(!c.isDisable){if(!c.phone)return void $.toast("手机号不能为空",1e3);if(!o.checkMobile(c.phone))return void $.toast("请输入正确的手机号",1e3);if(!c.captcha)return void $.toast("验证码不能为空");if(!c.password)return void $.toast("密码不能为空");if(c.password.length<6)return void $.toast("密码长度不能小于6位",1e3);if(c.password!=c.rePassword)return void $.toast("密码输入不一致");e("/rest-password",{phone:c.phone,password:c.password,captcha:c.captcha},function(e,t){$.hidePreloader(),e?$.toast(e,1e3):($.toast("密码重置成功, 请重新登录",1e3),location.href=t.redirect)}),$.showPreloader("请稍等")}}var c=new t({el:"#page-rest-password",data:{captchaTip:"获取验证码",isSendCaptcha:!1,isDisable:!0,captchaMsg:"",captcha:"",password:"",rePassword:"",phone:""},computed:{isDisable:function(){return!(this.phone&&this.captcha&&this.password&&this.rePassword)}},methods:{sendCaptcha:a,restPW:n}})}),$.init()})}();